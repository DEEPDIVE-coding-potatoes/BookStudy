# Ch 03 this

## 0️⃣ this ?

- 다른 객체지향 언어에서의 `this`는 클래스에서만 사용 가능하나, JS에서의 `this`는 어디서든 사용 가능
- **함수와 객체(메서드)를 구분하는 거의 유일한 기능**
- **함수를 호출할 때 결정됨**

## 1️⃣ 상황에 따라 달라지는 this

### 전역 공간에서의 this

- 이때 this는 `전역 객체`를 가리킴
- 전역 객체는 JS 런타임 환경에 따라 다른 이름과 정보를 가짐
브라우저 환경 : window
Node.js 환경 : global
- **JS의 모든 변수는 실행 컨텍스트(L.E)의 프로퍼티로 동작함**
    - **전역 변수를 선언하면 JS 엔진은 이를 전역객체의 프로퍼티로 할당함**
- 처음부터 전역객체의 프로퍼티로 할당했으면 삭제 ⭕️
- 전역변수로 선언한 경우 삭제 ❌

<aside>
🤔

전역 공간에서만 발생하는 특이한 성질 ?

전역변수를 선언하면 JS 엔진은 전역객체의 프로퍼티로 할당함

</aside>

### 함수, 메서드로서 호출할 때 그 함수, 메서드 내부에서의 this

> 함수 vs 메서드
> 
- 함수 : 독립성 ⭕
- 메서드 : 독립성 ❌

> **메서드 내부**에서의 this
> 
- this에는 호출한 주체에 대한 정보가 담김
- 어떤 함수를 메서드로서 호출하는 경우 : 호출 주체 - `함수명 앞의 객체`
- 점 표기법의 경우 : `마지막 점 앞에 명시된 객체`가 this가 됨

> **함수 내부**에서의 this
> 
- 어떤 함수를 함수로서 호출할 경우 : this가 지정되지 않음
- this는 `전역 객체`를 가리킴

1 ) 메서드의 내부 함수에서 this를 우회하는 방법

- ES5까지는 내부 함수에 this를 상속할 방법은 없었지만, `변수`를 활용해 우회가 가능함

2 ) this를 바인딩하지 않는 함수

- ES6에서는 `화살표 함수`를 도입하여 우회법이 불필요해짐
화살표 함수 : 실행 컨텍스트를 생성할 때 this 바인딩 과정 자체가 빠지게 되어, 상위 스코프의 this를 그대로 활용 가능함

### 콜백 함수 호출 시 그 함수 내부에서의 this

콜백 함수도 함수이기 때문에 this가 `전역객체`를 참조
제어권을 받은 함수에서 콜백 함수에 별도로 this가 될 대상을 지정한 경우에는 그 `대상`을 참조

### 생성자 함수 내부에서의 this

- 생성자 함수 : 어떤 공통된 성질을 지니는 객체들을 생성하는 데 사용하는 함수
- 어떤 함수가 생성자 함수로 호출된 경우 내부에서 this는 `곧 새로 만들 인스턴스 자신`이 됨

## 2️⃣ 명시적으로 this를 바인딩하는 방법

### call 메서드

```jsx
Function.prototype.call(thisArg[, arg1[, arg2[, ...]]])
```

- 메서드의 호출 주체인 함수를 즉시 실행
- 첫 번째 인자를 this로 바인딩하고, 이후의 인자들을 호출할 함수의 매개변수로 함

### apply 메서드

```jsx
Function.prototype.apply(thisArg[, argsArray])
```

- call 메서드와 기능적으로 완전히 동일함
- call 메서드와 달리 apply 메서드는 두 번째 인자(함수의 매개변수)를 배열로 받음
    - call 메서드는 첫 번째 인자를 제외한 나머지 모든 인자들을 호출할 함수의 매개변수로 지정함

### call / apply 메서드의 활용

> 유사배열객체에 배열 메서드를 적용
> 

<aside>
🤔

유사배열객체 ?

배열처럼 보이지만 key 가 숫자이고 length 값을 가지고 있는 객체

</aside>

- 객체에는 배열 메서드를 직접 적용할 수 없지만,
`키가 0 또는 양의 정수인 프로퍼티가 존재`하고, `length 프로퍼티의 값이 0 또는 양의 정수인 객체(유사배열객체)`인 경우 call / apply 메서드를 사용해 배열 메서드를 차용 가능
- `slice 메서드` : 배열 요소를 추출하는 메서드. 매개변수를 아무것도 넘기지 않을 경우 얕은 복사본을 반환함
→ argument 객체, NodeList도 유사배열객체이기 때문에 배열로 전환해서 활용 가능
- 문자열의 경우 length 프로퍼티가 읽기 전용이기 때문에 원본 문자열에 변경을 가하는 메서드(push, pop, shift, unshift, splice 등)는 에러를 던짐
- ES6에서는 유사배열객체 또는 순회 가능한 모든 종류의 데이터 타입을 배열로 전환하는 `Array.from 메서드` 도입

> 생성자 내부에서 다른 생성자를 호출
> 
- 생성자 내부에 다른 생성자와 공통된 내용이 있을 경우 call / apply 를 이용해 다른 생성자를 호출하면 반복을 줄일 수 있음

> 여러 인수를 묶어 하나의 배열로 전달하고 싶을 때 - apply
> 
- `Math.max` / `Math.min` 메서드는 인자로 여러 개를 받을 수 있는데, 배열을 직접 넘길 수 없음
- 배열을 직접 넘겨주기 위해 apply를 사용함
- Math.max 는 객체의 메서드가 아니어서 this 값은 null로 넘겨줌
- 배열의 앞에서부터 차례대로 인자로 들어가서 결과값과 다음 인자 값을 비교해 결과를 반환함
- ES6 문법인 `펼치기 연산자`를 이용하면 더 간편함
→ ES5 이하 환경에서 call / apply 메서드는 명시적으로 별도의 this를 바인딩하면서 함수 또는 메서드를 실행하는데, 이 때문에 this를 예측하기 어렵다는 단점이 있음

### bind 메서드

```jsx
Function.prototype.bind(thisArg[, arg1[, arg2[, ...]]])
```

- ES5에서 추가된 기능
- call과 비슷하지만 즉시 호출하지 않고 넘겨 받은 this 및 인수들을 바탕으로 새로운 함수를 반환하기만 함
- bind 메서드의 두 가지 목적 : **함수에 this를 미리 적용하는 것, 부분 적용 함수를 구현**

> name 프로퍼티
> 
- bind 메서드를 적용해 새로 만든 함수는 name 프로퍼티에 ‘bound’라는 접두어가 붙음
- 기존의 call이나 apply보다 코드 추적이 쉬움

```jsx
var func = function (a, b, c, d) {
	console.log(this, a, b, c, d);
};
var bindFunc = func.bind({ x: 1 }, 4, 5);
console.log(func.name);                    // func
console.log(bindFunc.name);                // bound func
```

> 상위 컨텍스트의 this를 내부함수나 콜백 함수에 전달하기
> 
- 변수를 활용해 우회하는 방법도 있지만, call, apply, bind 메서드를 사용해 더 깔끔한 처리가 가능함
- 콜백 함수를 인자로 받는 함수나 메서드 중에서 기본적으로 콜백 함수 내에서의 this에 관여하는 함수 또는 메서드에 대해서도 bind 메서드를 이용하면 this 값을 사용자에 맞춰 바꿀 수 있음

### 화살표 함수의 예외사항

- 실행 컨텍스트 생성 시 this를 바인딩 하는 과정이 없음
    
    → 함수 내부에 this가 아예 없으며, 접근하고자 하면 스코프체인상 가장 가까운 this에 접근하게 됨
    

### 별도의 인자로 this를 받는 경우(콜백 함수 내에서의 this)

- 콜백 함수를 인자로 받는 메서드 중 일부는 추가로 this로 지정할 객체를 인자로 지정 가능한 경우가 있음
- 배열 메서드에 많이 포진돼 있음
- 콜백 함수와 함께 this로 지정할 객체를 인자로 받는 메서드 :
`forEach`, `map`, `filter`, `some`, `find`, `findIndex`, `flatMap`, `from`